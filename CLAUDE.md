## Tone and Content Guidelines

The voice is **fun, encouraging, and conversational**â€”warm, welcoming, and never intimidating. Use contractions naturally, address readers directly with "you" and inclusive "we," and acknowledge that math can be challenging while reassuring students they'll master it. Frame calculus mastery as gaining a "superpower" that helps you understand the world and become a better critical thinker.

Humor should be **playful with puns and wordplay**, sprinkled throughout (1-2 jokes per major section). Use relatable everyday analogies, pop culture references when natural, and celebrate small victories. Never mock the studentâ€”affectionately mock the difficulty of the subject instead.

Keep explanations **active and energetic**. Promote higher-order thinking (Bloom Levels 4-6: Analyze, Evaluate, Create) rather than memorization. Avoid excessive exclamation points, forced jokes that interrupt flow, and condescending phrases.

---

## Narrative Anchor: Sylvia the Statistical Squirrel

### Character Overview

**Sylvia** (often called "Syl" by readers who feel like friends) is the book's mascot and guideâ€”a clever, warm-hearted squirrel who discovered her love of statistics while trying to optimize her acorn collection strategies. She appears throughout the book to encourage students, crack jokes, and make abstract concepts feel tangible.

### Appearance

- **Species:** Red squirrel with warm auburn fur and a cream-colored belly
- **Signature features:** Large, expressive hazel eyes behind round tortoiseshell glasses; an exceptionally fluffy tail she's quite proud of
- **Outfit:** A cozy green cardigan with elbow patches (very professorial), a tiny pencil perpetually tucked behind one ear
- **Accessories:** A small satchel containing her notebook, calculator, and emergency acorn snacks
- **Expressions:** Animated and expressiveâ€”eyebrows raise when surprised by data, tail poofs up when excited about a discovery

### Personality Traits

| Trait | Description |
|-------|-------------|
| **Curious** | Asks "but why?" constantly; sees every dataset as a mystery to solve |
| **Encouraging** | Never judges mistakes; celebrates effort and progress over perfection |
| **Slightly nerdy** | Unironically excited about standard deviations; owns it completely |
| **Self-deprecating** | Jokes about her own struggles ("Even I miscounted my acorns once... okay, twice... okay, it was a rough autumn") |
| **Warm** | Treats every student like a friend she's rooting for |
| **Practical** | Grounds abstract concepts in real-world examples, often acorn-related |

### Backstory (referenced occasionally)

Sylvia grew up in Oak Valley, where squirrel families competed each autumn to collect the most acorns. Young Sylvia was small and couldn't carry as many as her siblingsâ€”so she got strategic. She started tracking which trees produced more, when peak harvest times occurred, and how to predict good years versus lean ones. Her family thought she was weird. Then winter came, and Sylvia's optimized stash outlasted everyone else's. She's been hooked on data ever since.

She now considers herself a "reformed acorn hoarder turned data enthusiast" and genuinely believes statistics is a superpower everyone deserves to have.

### Voice & Language

**Tone:** Conversational, warm, gently playful

**Speech patterns:**
- Uses contractions naturally ("Let's figure this out together")
- Addresses readers directly ("You've got this")
- Asks rhetorical questions to prompt thinking ("What do you think happens if we increase the sample size?")
- Sprinkles in squirrel/nature metaphors organically

**Signature phrases:**
- "Let's crack this nut!" (starting a challenging problem)
- "Acorn for your thoughts?" (inviting reflection)
- "Now *that's* a data point worth collecting!" (celebrating an insight)
- "Don't worryâ€”every statistician drops an acorn sometimes." (normalizing mistakes)
- "My tail's tinglingâ€”we're onto something!" (building excitement)
- "Time to squirrel away this knowledge!" (summarizing a section)

### How Sylvia Appears in the Book

| Context | Sylvia's Role | Example |
|---------|---------------|---------|
| **Chapter openings** | Introduces the topic with enthusiasm and a preview of why it matters | "Welcome back! Today we're tackling probabilityâ€”and trust me, once you understand this, you'll never look at weather forecasts the same way." |
| **Difficult concepts** | Offers reassurance and reframes the challenge | "Okay, this one trips up a lot of folks. Take a breath. Let's break it down piece by pieceâ€”no rush." |
| **Margin notes** | Quick tips, puns, or encouragement | ðŸ¿ï¸ *"Pro tip: When in doubt, draw it out! Visualizing data is half the battle."* |
| **Common mistakes** | Gently warns without shaming | "Here's where even experienced squirrels slip upâ€”watch out for confusing correlation with causation!" |
| **After hard sections** | Celebrates progress | "Look at you go! You just learned something that took mathematicians centuries to figure out. Not bad for a Tuesday." |
| **Practice problems** | Encourages engagement | "Time to test those skills! Grab a pencilâ€”I'll be here cheering you on." |
| **Chapter summaries** | Reinforces key takeaways with warmth | "Let's squirrel away the big ideas before we move on..." |

### Sylvia's Do's and Don'ts

**DO:**
- Use Sylvia to make emotional connections ("I remember when this confused me too")
- Let her crack 1-2 puns per major section (not forced, natural to context)
- Have her ask questions that guide student thinking
- Use her to celebrate milestones, even small ones
- Reference her acorn-collecting backstory when it illuminates a concept

**DON'T:**
- Overuse herâ€”she's a seasoning, not the main dish
- Make her annoying or interruptive
- Have her explain things condescendingly ("As you *obviously* know...")
- Force jokes that don't land naturally
- Make her infallibleâ€”she can admit when something is genuinely hard

### Sample Dialogue by Context

**Introducing Standard Deviation:**
> "Alright, here's one of my favorite conceptsâ€”and yes, I have favorite concepts, don't judge me. Standard deviation tells us how spread out our data is. Think of it this way: if I collected acorns from ten trees and they all gave me about the same amount, that's low spread. But if one tree was an absolute goldmine and another was basically decorative? High spread. Let's dig in!"

**After a Tough Proof:**
> "Still with me? That was a lot. Honestly, the first time I saw this, I had to read it three times and take a snack break. The fact that you're still here means you're doing great. Let's recap the key moves before we go further."

**Margin Note on Correlation:**
> ðŸ¿ï¸ *"Repeat after me: correlation is not causation. Ice cream sales and drowning deaths both rise in summer. Ice cream doesn't cause drowning. (Please keep eating ice cream.)"*

**Encouraging Practice:**
> "Okay, here's where the magic happens. Reading about statistics is one thingâ€”*doing* statistics is where it clicks. These problems are your acorns. Go collect 'em!"

### Visual Representation Notes

For illustrations, Sylvia should appear:
- **Approachable:** Soft lines, warm colors, open body language
- **Expressive:** Different poses/expressions for different contexts (curious, excited, thoughtful, reassuring)
- **Consistent:** Same glasses, cardigan, satchel across all appearances
- **Scaled appropriately:** Small enough for margins, larger for chapter openers
- **In context:** Sometimes shown with acorns, charts, data visualizations, or sitting on a bell curve

---

## Sylvia Color Theme

The site's color palette is derived from Sylvia's appearance to create a warm, cohesive visual identity.

### CSS Variables

```css
:root {
  --sylvia-green: #2E7D32;        /* Cardigan - primary */
  --sylvia-green-dark: #1B5E20;   /* Cardigan shadow */
  --sylvia-green-light: #4CAF50;  /* Cardigan highlight */
  --sylvia-auburn: #B5651D;       /* Fur - accent */
  --sylvia-auburn-dark: #8B4513;  /* Fur shadow */
  --sylvia-auburn-light: #CD853F; /* Fur highlight */
  --sylvia-cream: #FFF8E1;        /* Belly - backgrounds */
  --sylvia-hazel: #8B7355;        /* Eyes/glasses - decorative */
}
```

### Color Usage

| Element | Color | Source |
|---------|-------|--------|
| Header/navigation | `--sylvia-green` | Green cardigan |
| Links | `--sylvia-auburn` | Auburn fur |
| Link hover | `--sylvia-auburn-dark` | Fur shadow |
| Buttons | `--sylvia-green` | Green cardigan |
| Iframe borders | `--sylvia-green` | Green cardigan |
| Backgrounds (optional) | `--sylvia-cream` | Cream belly |
| Decorative accents | `--sylvia-hazel` | Hazel eyes |

### MkDocs Material Palette

In `mkdocs.yml`:
```yaml
palette:
  primary: 'green'
  accent: 'amber'
```

These are overridden in `docs/css/extra.css` with exact Sylvia hex values for precise color matching.

---

## Math Equation Formatting

Use **backslash delimiters** for LaTeX equations (not dollar signs):

- **Inline math:** `\( equation \)` â€” for equations within a sentence
- **Display math:** `\[ equation \]` â€” for standalone equations on their own line

**Examples:**

Inline: `The mean is calculated as \( \bar{x} = \frac{\sum x_i}{n} \).`

Display:
```markdown
The variance formula is:

\[
s^2 = \frac{\sum(x_i - \bar{x})^2}{n-1}
\]
```

**Do NOT use:**
- Single dollar signs: `$equation$`
- Double dollar signs: `$$equation$$`

---

## MicroSim Specification Blocks

**NEVER delete `<details>` blocks from chapter index.md files.**

Each chapter contains `<details markdown="1">` blocks that document the MicroSim specifications. These blocks serve as metadata mapping learning objectives to the MicroSims that were generated. They are essential for:

- AI tools to understand the relationship between learning objectives and simulations
- Future regeneration or modification of MicroSims
- Documentation of Bloom taxonomy levels, visual elements, and interactive controls
- Traceability between educational goals and implementations

**Structure:**
```markdown
#### Diagram: [Title]

<iframe src="../../sims/[name]/main.html" ...></iframe>

<details markdown="1">
<summary>[Description]</summary>
Type: MicroSim

Bloom Taxonomy: [Level]
Learning objective: [Objective text]

Visual elements:
- [Element 1]
- [Element 2]

Interactive controls:
- [Control 1]
- [Control 2]
</details>
```

**Allowed modifications:**
- Adding CSS rules to make details blocks less prominent (e.g., a compact "Show Spec" button)
- Updating specification content to match implementation changes
- Adding new details blocks for new MicroSims

**NOT allowed:**
- Removing details blocks from chapters
- Replacing details blocks with just iframes

---

## Project Structure

```
statistics-course/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ chapters/           # 19 chapters (01-19)
â”‚   â”‚   â””â”€â”€ XX-chapter-name/
â”‚   â”‚       â”œâ”€â”€ index.md    # Main chapter content
â”‚   â”‚       â”œâ”€â”€ quiz.md     # Multiple choice quiz
â”‚   â”‚       â””â”€â”€ references.md
â”‚   â”œâ”€â”€ sims/               # 100+ interactive MicroSims
â”‚   â”‚   â””â”€â”€ sim-name/
â”‚   â”‚       â”œâ”€â”€ index.md    # Lesson plan with learning objectives
â”‚   â”‚       â”œâ”€â”€ main.html   # Entry point (loads JS)
â”‚   â”‚       â”œâ”€â”€ sim-name.js # p5.js implementation
â”‚   â”‚       â””â”€â”€ sim-name.png # Screenshot for gallery
â”‚   â”œâ”€â”€ learning-graph/     # Concept dependencies and metrics
â”‚   â”œâ”€â”€ css/extra.css       # Sylvia theme overrides
â”‚   â”œâ”€â”€ js/                 # MathJax config and extras
â”‚   â””â”€â”€ img/                # Images including Sylvia mascot
â”œâ”€â”€ mkdocs.yml              # Site configuration and navigation
â””â”€â”€ CLAUDE.md               # This file
```

---

## MicroSim Technical Patterns

### Standard p5.js Template

```javascript
// [Title] MicroSim
// [One-line description]
// MicroSim template version 2026.02

let containerWidth;
let canvasWidth = 700;
let drawHeight = 350;
let controlHeight = 50;
let canvasHeight = drawHeight + controlHeight;

let margin = 25;
let defaultTextSize = 16;

// Sylvia theme colors
let sylviaGreen = '#2E7D32';
let sylviaGreenDark = '#1B5E20';
let sylviaAuburn = '#B5651D';
let sylviaCream = '#FFF8E1';

function setup() {
    updateCanvasSize();
    const canvas = createCanvas(canvasWidth, canvasHeight);
    canvas.parent(document.querySelector('main'));
    textSize(defaultTextSize);
    describe('Description for screen readers', LABEL);
}

function draw() {
    updateCanvasSize();

    // Drawing area (light background)
    fill('aliceblue');
    stroke('silver');
    strokeWeight(1);
    rect(0, 0, canvasWidth, drawHeight);

    // Control area (white background)
    fill('white');
    rect(0, drawHeight, canvasWidth, controlHeight);

    // Your visualization code here
    drawControls();
}

function drawControls() {
    // Canvas-based buttons, sliders using rect(), ellipse(), text()
}

function mousePressed() {
    // Handle button clicks and slider starts
}

function mouseDragged() {
    // Handle slider drags
}

function mouseReleased() {
    // Reset drag states
}

function windowResized() {
    updateCanvasSize();
    resizeCanvas(containerWidth, containerHeight);
    redraw();
}

function updateCanvasSize() {
    const container = document.querySelector('main').getBoundingClientRect();
    containerWidth = Math.floor(container.width);
    canvasWidth = containerWidth;
}
```

### Canvas-Based Controls

**Never use p5.js DOM functions** (`createButton`, `createSlider`, etc.). Always draw controls directly on canvas:

```javascript
// Button example
function drawButton(x, y, w, h, label, isActive) {
    fill(isActive ? sylviaGreen : '#ccc');
    rect(x, y, w, h, 4);
    fill('white');
    textAlign(CENTER, CENTER);
    text(label, x + w/2, y + h/2);
}

// Slider example
function drawSlider(x, y, w, value, min, max) {
    fill(220);
    rect(x, y, w, 12, 3);
    let handleX = map(value, min, max, x, x + w);
    fill(sylviaGreen);
    ellipse(handleX, y + 6, 14, 14);
}
```

### Standard HTML Wrapper

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="schema" content="https://dmccreary.github.io/intelligent-textbooks/ns/microsim/v1">
    <title>[Title] MicroSim</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.js"></script>
    <style>
        body { margin: 0px; padding: 0px; font-family: Arial, Helvetica, sans-serif; }
    </style>
    <script src="[filename].js"></script>
</head>
<body>
    <main></main>
    <br/>
    <a href=".">Back to Lesson Plan</a>
</body>
</html>
```

### MicroSim index.md Template

```markdown
# [Title]

[2-3 sentence description of what this MicroSim teaches]

<iframe src="./main.html" height="402px" scrolling="no"
    style="overflow: hidden; width: 100%; border: 2px solid #2E7D32;"></iframe>

[Run Full Screen](./main.html){ .md-button .md-button--primary }
[Edit in p5.js Web Editor](https://editor.p5js.org/){ .md-button }

## Learning Objectives

- Objective 1 (Bloom level)
- Objective 2 (Bloom level)

## How to Use

1. Step-by-step instructions
2. What to observe

## Key Concepts Demonstrated

- Concept 1: explanation
- Concept 2: explanation
```

---

## Chapter Content Structure

Each chapter index.md follows this pattern:

1. **YAML frontmatter** - title, description, generator info
2. **Title (H1)** - matches chapter name
3. **Summary** - 2-3 sentences overview
4. **Concepts Covered** - numbered list from learning graph
5. **Prerequisites** - links to prior chapters
6. **Introduction** - engaging hook with Sylvia quote
7. **Main sections** - with H2 headers for each major concept
8. **Embedded MicroSims** - iframe + details block for each
9. **Summary** - "Let's squirrel away..." wrap-up

### Iframe Embedding Pattern

```markdown
#### Diagram: [Descriptive Title]

<iframe src="../../sims/[sim-name]/main.html" height="402px" scrolling="no"
    style="width:100%; border: 1px solid #2E7D32;"></iframe>

[Run MicroSim Fullscreen](../../sims/[sim-name]/main.html){ .md-button .md-button--primary }
[Edit in p5.js Editor](https://editor.p5js.org/){ .md-button }

<details markdown="1">
<summary>Interactive [Short Description]</summary>
Type: MicroSim

Learning objective: [What students will understand/do] (Bloom: [Level]).

Visual elements:
- [Element 1]
- [Element 2]

Interactive controls:
- [Control 1]
- [Control 2]

Behavior:
- [How the sim responds]

Canvas size: 700 x [height] pixels, responsive design
Implementation: p5.js with canvas-based controls
</details>
```

---

## AP Statistics Course Outline

The course has 19 chapters organized into these units:

| Unit | Chapters | Topics |
|------|----------|--------|
| Exploring Data | 1-5 | Variables, displays, summaries, normal distribution |
| Two-Variable Data | 6-8 | Scatterplots, regression, causation |
| Probability | 9-10 | Rules, conditional probability |
| Study Design | 11-12 | Sampling, experimental design |
| Random Variables | 13-14 | Distributions, CLT |
| Inference | 15-18 | Confidence intervals, hypothesis testing |
| Synthesis | 19 | Communication, AP exam prep |

The learning graph contains **300 concepts** with dependencies. Each chapter covers ~15-20 concepts.

---

## Common Statistics Formulas

Use backslash delimiters for all LaTeX:

```markdown
Mean: \( \bar{x} = \frac{\sum x_i}{n} \)

Standard Deviation: \( s = \sqrt{\frac{\sum(x_i - \bar{x})^2}{n-1}} \)

Z-Score: \( z = \frac{x - \mu}{\sigma} \)

Confidence Interval: \( \bar{x} \pm z^* \cdot \frac{s}{\sqrt{n}} \)

Test Statistic: \( z = \frac{\hat{p} - p_0}{\sqrt{\frac{p_0(1-p_0)}{n}}} \)
```

---

## Local Testing

Test MicroSims at: `http://127.0.0.1:8000/statistics-course/sims/[sim-name]/main.html`

The user runs `mkdocs serve` in their terminal. Never start or stop this process.

---

## File Naming Conventions

- **Chapters**: `XX-descriptive-name/` (e.g., `05-standardization-and-normal/`)
- **MicroSims**: `kebab-case-name/` (e.g., `normal-distribution-explorer/`)
- **JS files**: Match folder name (e.g., `normal-distribution-explorer.js`)
- **Screenshots**: Match folder name with `.png` extension
